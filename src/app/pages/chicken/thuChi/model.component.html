<nb-card>
  <nb-card-header>DANH SÁCH THU CHI TRONG THÁNG HIỆN TẠI</nb-card-header>
  <nb-card-body class="list-order cong-no">
    <div class="order-date-filter">
      <div class="row">
        <div class="col-sm-5">
          <mat-form-field>
            <mat-label>LỌC THEO NGÀY</mat-label>
            <mat-date-range-input [rangePicker]="picker" (click)="picker.open()">
              <input matStartDate placeholder="Ngày Bắt Đầu" #dateRangeStart [ngModel]="startDate">
              <input matEndDate placeholder="Ngày Cuối"
                     #dateRangeEnd [ngModel]="endDate"
                     (dateChange)="filterByDate(dateRangeStart, dateRangeEnd)">
            </mat-date-range-input>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
          <div (click)="resetFilter()" class="reset-filter">
            <button mat-button (click)="resetFilter()">LỌC MẶC ĐỊNH</button>
          </div>
          <div class="comeback text-left mb-3">
            <button nbButton status="danger" (click)="themMoi('chi')" class="add-chi">THÊM CHI</button>
            <button nbButton status="success" (click)="themMoi('thu')">THÊM THU</button>
          </div>
          <div class="comeback text-left mb-3">
            <button nbButton status="warning" (click)="walletTransfer()">CHUYỂN TIỀN GIỮA CÁC VÍ</button>
          </div>
          <div class="comeback text-left mb-3">
            <button nbButton status="primary" (click)="exportToExcel()" class="d-print-none">XUẤT RA EXCEL</button>
          </div>
        </div>

        <div class="col-sm-7">
          <div class="clearfix">
            <h5> VÍ </h5>
            <div class="table-responsive">
              <table class="table table-striped table-dark table-hover">
                <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">TÊN</th>
                  <th scope="col">TIỀN MẶT</th>
                  <th scope="col">TIỀN TK</th>
                  <th scope="col">TỔNG</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let w of wallets; index as idx;">
                  <th scope="row">{{ idx + 1 }}</th>
                  <td>{{ w?.name }}</td>
                  <td>{{ w?.cashTotal | currency : '' : '' : '1.0-0' }}</td>
                  <td>{{ w?.bankTotal | currency : '' : '' : '1.0-0' }}</td>
                  <td>{{ w?.cashTotal + w?.bankTotal | currency : '' : '' : '1.0-0' }}</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="clearfix">
            <h5> CÔNG NỢ NHÀ CUNG CẤP </h5>
            <div class="table-responsive">
              <table class="table table-striped table-dark table-hover">
                <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">TÊN</th>
                  <th scope="col">TỔNG</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let w of nhaCungCaps; index as idx;">
                  <th scope="row">{{ idx + 1 }}</th>
                  <td>{{ w?.name }}</td>
                  <td>{{ w?.price ?? 0 | currency : '' : '' : '1.0-0' }}</td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nb-card-body>
</nb-card>
<nb-card>
  <nb-card-body class="thu-chi">
    <div class="row">
      <div class="col-sm">
        <p>Tổng thu: <strong>{{ price.tienDaThu | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
        <p>Tổng chưa thu: <strong>{{ price.tienChuaThu | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
        <p>Tổng chi: <strong>{{ price.chi | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
      </div>
      <div class="col-sm">
        <p class="kdanger">Tổng nợ nhà cung cấp: <strong>{{ cnNcc | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
        <p class="kokay">Công ty còn: <strong>{{ price.tienDaThu - price.chi | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
      </div>
    </div>
    <h4 class="text-center" *ngIf="dateFilter?.startDate !== 'Invalid Date' && dateFilter?.endDate !== 'Invalid Date'">Chi Tiết Thu Chi. Từ {{ dateFilter?.startDate | date : 'dd/MM/YYYY' }}
      - {{ dateFilter?.endDate | date : 'dd/MM/YYYY' }}</h4>
    <mat-accordion class="mb-5">
      <mat-expansion-panel [expanded]="false">
        <mat-expansion-panel-header>
          <mat-panel-title>
            THU ({{ tongThuFilter?.length }})
          </mat-panel-title>
        </mat-expansion-panel-header>
        <nb-card-body>
          <div class="table-responsive">
            <p>Tổng thu: <strong>{{ priceFilter.tienDaThu | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
            <p>Tổng chưa thu: <strong>{{ priceFilter.tienChuaThu | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
            <table class="table table-striped table-hover">
              <thead>
              <tr>
                <th scope="col" class=" d-none1" *ngIf="isAdminRole"></th>
                <th scope="col"></th>
                <th scope="col">NGÀY</th>
                <th scope="col">KHOẢN THU</th>
                <th scope="col">ĐỐI TÁC</th>
                <th scope="col">SỐ TIỀN</th>
                <th scope="col">ẢNH</th>
                <th scope="col">Trạng Thái</th>
                <th scope="col">VÍ</th>
                <th scope="col">Hình thức</th>
                <th scope="col">GHI CHÚ</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let tc of tongThuFilter">
                <td (click)="onDeleteConfirm(tc.key)" class="delete d-none1" *ngIf="isAdminRole">XÓA</td>
                <td (click)="suaKhoanThu(tc.key)" class="delete">SỬA</td>
                <td>{{ tc.date | date : 'dd/MM/YYYY' }}</td>
                <td>{{ tc?.name }}</td>
                <td>{{ tc?.customer?.name }}</td>
                <td>{{ tc.price | currency : '' : '' : '1.0-0' }}</td>
                <td>
                  <div *ngIf="tc?.url" matTooltip="Ấn vào để xem ảnh to">
                    <img [src]="tc?.url" alt="" (click)="showImage(tc.url, true)"/>
                  </div>
                  <div class="file-upload">
                    <ul class="list-group list-group-flush"
                        *ngFor="let file of tc?.files">
                      <li class="list-group-item">
                        <app-upload-details [fileUpload]='file' [allowDelete]="false"
                                            (showImg)="showImage($event)"></app-upload-details>
                      </li>
                    </ul>
                  </div>
                </td>
                <td>{{ tc.trangThaiLabel }}</td>
                <td>{{ tc?.wallet?.name }}</td>
                <td>{{ tc?.paymentTypeLabel }}</td>
                <td>{{ tc.note }}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </nb-card-body>

      </mat-expansion-panel>
    </mat-accordion>
    <mat-divider class="mt-3 mb-3"></mat-divider>
    <mat-accordion>
      <mat-expansion-panel [expanded]="false">
        <mat-expansion-panel-header>
          <mat-panel-title>
            CHI ({{ tongChiFilter?.length }})
          </mat-panel-title>
        </mat-expansion-panel-header>
        <nb-card-body>
          <div class="table-responsive">
            <div class="row">
              <div class="col-sm">
                <p>Tổng chi: <strong>{{ priceFilter.chi | currency : '' : '' : '1.0-0' }} VNĐ</strong></p>
              </div>
            </div>
            <table class="table table-striped table-hover">
              <thead>
              <tr>
                <th scope="col" class=" d-none1" *ngIf="isAdminRole"></th>
                <th scope="col"></th>
                <th scope="col">NGÀY</th>
                <th scope="col">KHOẢN CHI</th>
                <th scope="col">SỐ LƯỢNG</th>
                <th scope="col">SỐ TIỀN</th>
                <th scope="col">ẢNH</th>
                <th scope="col" class="d-none">TT-Lương?</th>
                <th scope="col">VÍ</th>
                <th scope="col">Hình thức</th>
                <th scope="col">GHI CHÚ</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let tc of tongChiFilter">
                <td (click)="onDeleteConfirm(tc.key)" class="delete d-none1" *ngIf="isAdminRole">XÓA</td>
                <td (click)="suaKhoanThu(tc.key)" class="delete">SỬA</td>
                <td>{{ tc.date | date : 'dd/MM/YYYY' }}</td>
                <td>{{ tc.name }}</td>
                <td>{{ tc.soLuong }}</td>
                <td>{{ tc.price | currency : '' : '' : '1.0-0' }}</td>
                <td>
                  <div *ngIf="tc?.url" matTooltip="Ấn vào để xem ảnh to">
                    <img [src]="tc?.url" alt="" (click)="showImage(tc.url, true)"/>
                  </div>
                  <div class="file-upload">
                    <ul class="list-group list-group-flush"
                        *ngFor="let file of tc?.files">
                      <li class="list-group-item">
                        <app-upload-details [fileUpload]='file' [allowDelete]="false"
                                            (showImg)="showImage($event)"></app-upload-details>
                      </li>
                    </ul>
                  </div>
                </td>
                <td class="text-left d-none" *ngIf="tc.ttLuong">YES</td>
                <td class="text-left d-none" *ngIf="!tc.ttLuong">NO</td>
                <td>{{ tc?.wallet?.name }}</td>
                <td>{{ tc?.paymentTypeLabel }}</td>
                <td>{{ tc.note }}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </nb-card-body>
      </mat-expansion-panel>
    </mat-accordion>

    <!--    <div class="file-upload d-none">-->
    <!--      <ul class="list-group list-group-flush"-->
    <!--          *ngFor="let file of fileUploads">-->
    <!--        <li class="list-group-item">-->
    <!--          <app-upload-details [fileUpload]='file' [allowDelete]="true"></app-upload-details>-->
    <!--        </li>-->
    <!--      </ul>-->
    <!--    </div>-->
  </nb-card-body>
</nb-card>

